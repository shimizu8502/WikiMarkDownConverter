# PukiWiki to Markdown Converter

## 概要

このスクリプトは、PukiWiki形式で記述されたテキストファイルをMarkdown形式に変換します。
GUIインターフェースを提供し、PukiWikiデータが格納されたディレクトリと、変換後のMarkdownファイルを出力するディレクトリを簡単に指定できます。
特に、Obsidianでの利用を想定した内部リンク形式で出力します。

## 主な機能

*   PukiWikiの主要な構文をMarkdownに変換
    *   見出し (`*`, `**`, `***`)
    *   リスト (`-`, `+`)
    *   強調 (`'''文字列'''`, `''文字列''`)
    *   リンク (`[[ページ名]]` -> `[[ページ名]]` (Obsidian形式), `[[エイリアス>ページ名]]` -> `[[ページ名|エイリアス]]` (Obsidian形式))
    *   画像 (`#ref(画像URL,altテキスト)`)
    *   整形済みテキスト (行頭が半角スペース) -> Markdownコードブロック
    *   表組み (基本的なもの、Obsidianでの表示互換性のためにテーブル前に改行を挿入)
    *   コメント (`//`) の除去
*   入力ファイルの文字コード自動判別 (UTF-8, EUC-JP, Shift_JIS) および手動指定
*   GUIによる簡単な操作
*   設定ファイル (`converter_settings.ini`) によるディレクトリパスとエンコーディング設定の保存・読み込み
*   変換実行時に出力ディレクトリ内の既存 `.md` ファイルを削除するオプション
*   エラーログ機能：変換中に発生したエラーを `logs/conversion_errors.log` に記録

## 必要なもの

*   Python 3.x

## 使用方法

1.  **スクリプトの実行**:
    ```bash
    python pukiwiki_to_markdown.py
    ```
    上記コマンドを実行すると、GUIウィンドウが表示されます。

2.  **ディレクトリの選択**:
    *   「PukiWikiデータディレクトリ」の右側にある「選択」ボタンをクリックし、PukiWiki形式のファイル (`.txt` や `.page`) が保存されているフォルダを選択します。
    *   「Markdown出力ディレクトリ」の右側にある「選択」ボタンをクリックし、変換されたMarkdownファイル (`.md`) を保存するフォルダを選択します。このフォルダが存在しない場合は、変換実行時に自動的に作成されます。
    *   前回使用したディレクトリパスは `converter_settings.ini` に保存され、次回起動時に自動的に読み込まれます。

3.  **文字コードの指定 (オプション)**:
    *   デフォルトでは「auto」(自動判別) が選択されています。PukiWikiファイルの文字コードが特殊な場合や、自動判別がうまくいかない場合は、ドロップダウンメニューから適切な文字コード (utf-8, euc-jp, shift_jis) を選択してください。
    *   選択したエンコーディング設定も `converter_settings.ini` に保存されます。

4.  **変換の実行**:
    *   「変換実行」ボタンをクリックします。
    *   出力ディレクトリに既存の `.md` ファイルがある場合、それらを削除するか確認するメッセージが表示されます。「はい」を選択すると既存ファイルが削除され、「いいえ」を選択すると既存ファイルは残したまま変換が続行されます。
    *   変換処理が開始され、進捗はコンソールに出力されます。
    *   処理が完了すると、結果がダイアログで表示されます。

## 出力

*   指定されたMarkdown出力ディレクトリに、元のPukiWikiのページ名と同じ名前で拡張子が `.md` のMarkdownファイルが作成されます。
*   ページ間のリンクはObsidianのWikiリンク形式 (`[[ページ名]]` または `[[ページ名|エイリアス]]`) で出力されます。
*   表は、Obsidianでの表示を考慮し、テーブルの前に改行が挿入された形式で出力されます。
*   ディレクトリ構造は維持されず、フラットな構造で出力ディレクトリ直下に保存されます。
*   変換中に発生したエラーは `logs/conversion_errors.log` に記録されます。エラーが発生した場合、処理完了メッセージにログファイルの場所が表示されます。

## 注意事項

*   **対応構文**: このスクリプトは一般的なPukiWikiの主要な構文に対応していますが、全てのPukiWikiの構文やプラグインに対応しているわけではありません。複雑な構文や独自拡張された構文は、正しく変換されない場合があります。
*   **整形済みテキストと表組み**: 整形済みテキストと表組みの変換は簡易的なものです。特に複雑な構造の場合、期待通りに変換されない可能性があります。
*   **エラー処理**: ファイルの読み込みエラーや変換エラーが発生した場合、エラーメッセージがコンソールに出力され、ログファイル（`logs/conversion_errors.log`）に記録されます。該当ファイルの処理はスキップされますが、処理全体は続行されます。
*   **文字コード**: 文字コードの自動判別は100%正確ではありません。判別できない場合や誤判別する可能性がある場合は、手動で文字コードを指定してください。出力されるMarkdownファイルはUTF-8でエンコードされます。
*   **ファイル名**: PukiWikiのファイル名が16進数エンコードされている場合、UTF-8へのデコードを試みます。

## 今後の改善点 (TODO)

*   より多くのPukiWiki構文およびプラグインへの対応。
*   整形済みテキストや表組みの変換精度の向上と、元のドキュメント構造における位置の維持。
*   GUIでの進捗表示の改善。 